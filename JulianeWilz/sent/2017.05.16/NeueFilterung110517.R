rm(list=ls())

#setwd("~/Desktop/pv0116_neu/")
setwd( "~/LIFE/life-for-postgraduates/JulianeWilz/data" )

library(readxl)
library( dplyr )
library( ggplot2 )
library( GGally )
library( Hmisc )
library(dplyr)
library(openxlsx)

Daten <- read_excel( "PV0116_GesamtJoin.xlsx" )
Daten <- Daten[ !is.na( Daten$CT_S_1_NUM_VALUE ), ]

diseases <- c( "C_DISEASE_TX_SD_ALLG", "C_DISEASE_TX_SD_HYPER",
               "C_DISEASE_TX_SD_HYPO", "C_DISEASE_TX_VITD", "C_DISEASE_TX_DM1", "C_DISEASE_TX_DM2", 
               "C_DISEASE_TX_BLUT", "C_DISEASE_TX_GERIN", 
               "C_DISEASE_TX_NEPHRO", "C_DISEASE_TX_NIERENFEHL",
               "C_DISEASE_TX_ANGIO", "C_DISEASE_TX_DEPRES", "C_DISEASE_TX_SUCHT", 
               "C_DISEASE_TX_MUSKEL", "C_DISEASE_TX_GIT", "C_DISEASE_TX_KARDIO",  
               "C_DISEASE_TX_KARDIO_RHYTH")

#diseases1 <- c( "C_DISEASE_TX_SD_ALLG", "C_DISEASE_TX_SD_HYPER",
#"C_DISEASE_TX_SD_HYPO", "C_DISEASE_TX_VITD", "C_DISEASE_TX_DM1", "C_DISEASE_TX_DM2", 
#"C_DISEASE_TX_BLUT", "C_DISEASE_TX_GERIN", 
#"C_DISEASE_TX_NEPHRO", "C_DISEASE_TX_NIERENFEHL",
#"C_DISEASE_TX_ANGIO", "C_DISEASE_TX_DEPRES", "C_DISEASE_TX_SUCHT", 
#"C_DISEASE_TX_MUSKEL")




medik <- c( "CHILD_MED_H_METFORMIN", "CHILD_MED_H_INSULIN", "CHILD_MED_H_LTHYROX",
            "CHILD_MED_H_HORMONE", "CHILD_MED_H_SEX_STEROIDE", "CHILD_MED_H_WACHSTUM",
            "CHILD_MED_H_DESMOPRESS",  "CHILD_MED_H_GLUCO_CORT",
            "CHILD_MED_H_TESTO", "CHILD_MED_H_ASTHMA")

df <- Daten

nrow(df)

# So testest Du, ob alle durch diseases ausgewaehlten Spalten keine Missings enthalten.
# Ich empfehle aber, diese Zeile nicht auszufuehren, da Dir so viele Werte verloren gehen.
# Geht man davon aus, dass der Proband nur krank ist, wenn tatsaechlich irgendwo eine 1 steht,
# dann kannst Du die Missings uebersehen.
# VARIANTE A
df.diseases <-
    df[ complete.cases( df[ , diseases ] ), ]

# Fuehre lieber diese Zeile aus!
# VARIANTE B
df.diseases <- df

# Die Funktion "filter.for.certain.values" filtert alle Zeilen, die bei irgendeiner Krankheit eine 1 stehen haben, aus.
# NAs werden nicht beachtet.
# Moechtest Du diese aber auch raushaben, dann fuehre vorher Variante A aus statt Variante B!
# Das ganze dauert einen kleinen Moment
filter.for.certain.values <-
function( d, cols ) {
    
    j = 1
    
    for( i in 1 : nrow( d ) ) {
    
        if( !any( !is.na( d[ i , cols ] ) & d[ i , cols ] == 1 ) ) {
            
            d[ j, ] <- d[ i, ]
            
            j <- j + 1
        }
    }
    
    ( df.diseases <- df.diseases[ 1 : j - 1, ] )
}

df.diseases <- 
    filter.for.certain.values( df.diseases, diseases )




df <- Daten

for( d in medik ) {
  
  df <- df[ df[ ,d ] == 0 | is.na(df[ ,d ]), ]
}

nrow(df)

#nichtausgeschlossen#Hüftdysplasie <- c("7D32247AE1A2_3M","5E726880B3A2_3M","9455D30FA4A2_3M","6A4A9D2DE4A2_3M", "9455D30FA4A2_01","07E300BEFAA2_01"
#"4293018CFFA2_6M","57145BC607A2_01","8D7AB20F9CA2_3M","C4280BA5C4A2_3M","63B6F4042BA2_3M","57145BC607A2_6M")

#ASD <- c("F4D84480C7A2_03" )

#VSD <- c("19BD6A6AACA2_10","37A2BC8419A2_05","63820C4B8EA2_3M","8641A70968A2_3M","8E72CCA696A2_3M","C4C48F737AA2_04")

#Mitral <- c("E7B754719CA2_14","1D1327997BA2_08","072C7C1912A2_13","27CC9E6D64A2_05", "46CB460261A2_08",
 #"90F008C440A2_13", "B383040016A2_10")

#Aorten <- c("28CCC778A4A2_15", "3F3B78A16DA2_04", "E8FA497455B1_14")

#mehrereHerzkrankheiten <- c("28CCC778A4A2_13")

#MMeulengracht<- c("E60A583B4AA2_14", "D1E1792725A2_11","228CA1C40EA2_02", "EACDCF372DA2-SK_01" )

#nichtausgeschlossen#Ikterus <- c("F253BA9FDCA2-SK_01", "40EF9053CDA2_3M","27F3AAFDF8A2-SK_01","4C1C477A09A2_3M","72AC41C68FA2_3M","2D14EEAF9EA2_3M"
#"7F5A47DEFAA2_01", "B6FC81B271A2_3M","38CF322948A2_3M","8641A70968A2_3M")

#Niere <- c("CAA1484CF0A2_04", "2DC3B0ADE2A2_11","B5286CD3F9A2_15","7179E63ED5A2_06","081940C4D5A2_10","BF1ADED87CA2_3M","69FEBB9A07A2_08",
#"DFEA8BF395A2_09","DADED57804A2_07","3E0513BAA2A2_16","FBC647BF53A2_01","ED731EADAEA2_11")

#GIT <- c("3FB83E76EDA2-SK_05")

#Ausreißer <- c("FC11C38221A2_3M")

#Knochen <- c("7BF6EFE2CDA2_06", "87691882D4A2-SK_01","9C4A6A31B5A2_12","D22C464F28A2_10","353A8B3870A2_10","7D09FB4586A2_12","4B58B02900A2_12",
#"6C0AC81AE7A2-SK_01","76C48EF23BA2-SK_02","53225E8183A2_12","C0A44D788AA2_13","5D17742E68A2-SK_03","9E7C2CF446A2_11","7F8C935C88B1_14","8D37A6E155A2_14",
#"2B0240A66DA2_13","0FB7E114F6A2_16","5BC70742CEB1_13","29E70F2C61A2-SK_02","6634694A7CA2_14","20D4416103A2-SK_03" ,"710EA2D8A3A2_12","DDAF42DD68A2-SK_04",
#"0EE9B0EFD2B1_15","6622F5E746A2_14","2B9F681AB3A2-SK_01","F9F266BDB8A2_14")

#Gehirnschädigung/Retardierung <- c("08BC3D640DB1_15", "0A7F789EFBA2_11","08BC3D640DB1_14")

#sonstiges <- c("278D8061B2A2_05", "DC395B3CC8A2_3M","B03385C1E3A2_13","2542D1625CA2_03","7B4E0CDAE8A2_14","A0EC5EB277A2_02","F3BE3660F0A2-SK_01",
#"AC2DB1F248A2_3M","FDC849B4BFA2-SK_01","238AF1D07CA2_16","9249323B02A2_07","79FD6D1603A2_08","86CCE3AE09A2-SK_01", "3495EE330CA2_11","3495EE330CA2_10",
 #"0677B362C6A2_11","4880CB93E3A2_08","674CF37825A2_05","D4C93A0446A2_03","713D6B6534A2_07","6AF8E2DDADA2_15","35D5BA9E5EA2_10","7B54C4FAEEB1_08",
#"BC26147BECA2-SK_05","0A7F789EFBA2_12","844E26F4B0A2_11", "6553E9B0FFA2_16")

#Hormone/Kleinwuchs/Großwuchs <- c("A32701D433A2_05","1708D266B1B1_14","FA8AD8BD1DA2_03",
#"EED92F1F55A2_12","28EFA1AD5AB1_14","B357E9BB61B1_10","A290507BB8A2_06","2D0EF351A6A2-SK_02","31851D333FA2_6M",
#"EB9B84517CA2_03","99F6DA6C37B1_09","9BB155D7D0B1_16","16A74EFEF4A2_12","65BBC9638AA2_09")

#Ritalin <- c("3234E27F42B1_16","3F37D4C832A2_11","5F56BA3A4AB1_12","8504D6FB2EA2_13","E72CDACCBAA2_15","8504D6FB2EA2_12","03419A0DEAA2-SK_01",
#"8504D6FB2EA2_14" )

#maligneErkrankung <-  c("58E7E02A9EB1_15", "3870E289B1A2_3M")
#MuskuläreErkrankung <- c("4F267F4F54A2_16","BF6CDD9F6FA2_10","B984F164F8A2_01")
#Hodenentfernung <- c("3BFB8F8246A2_09")

#Pantoprazol <- c("32A73968C0A2_15", "F5936AD536A2_15", "840D327FDAA2_14", "9C3E0A5C7AA2_14", "E7E6C4D7F9A2_15")


#Wachstumsretardierung <- c("BF00616007A2_12","E1A9F2741DB1_10")

SICGROUP <- c("F4D84480C7A2_03","19BD6A6AACA2_10","37A2BC8419A2_05","63820C4B8EA2_3M","8641A70968A2_3M","8E72CCA696A2_3M","C4C48F737AA2_04",
              "E7B754719CA2_14","1D1327997BA2_08","072C7C1912A2_13","27CC9E6D64A2_05", "46CB460261A2_08",
              "90F008C440A2_13", "B383040016A2_10","28CCC778A4A2_15", "3F3B78A16DA2_04", "E8FA497455B1_14",
              "28CCC778A4A2_13","E60A583B4AA2_14", "D1E1792725A2_11","228CA1C40EA2_02", "EACDCF372DA2-SK_01",
              "CAA1484CF0A2_04", "2DC3B0ADE2A2_11","B5286CD3F9A2_15","7179E63ED5A2_06","081940C4D5A2_10","BF1ADED87CA2_3M", "69FEBB9A07A2_08",
              "DFEA8BF395A2_09","DADED57804A2_07","3E0513BAA2A2_16","FBC647BF53A2_01","ED731EADAEA2_11","3FB83E76EDA2-SK_05",
              "FC11C38221A2_3M","7BF6EFE2CDA2_06", "87691882D4A2-SK_01","9C4A6A31B5A2_12","D22C464F28A2_10","353A8B3870A2_10","7D09FB4586A2_12", "4B58B02900A2_12",
              "6C0AC81AE7A2-SK_01","76C48EF23BA2-SK_02","53225E8183A2_12","C0A44D788AA2_13","5D17742E68A2-SK_03","9E7C2CF446A2_11","7F8C935C88B1_14", "8D37A6E155A2_14",
              "2B0240A66DA2_13","0FB7E114F6A2_16","5BC70742CEB1_13","29E70F2C61A2-SK_02","6634694A7CA2_14","20D4416103A2-SK_03" ,"710EA2D8A3A2_12", "DDAF42DD68A2-SK_04",
              "0EE9B0EFD2B1_15","6622F5E746A2_14","2B9F681AB3A2-SK_01","F9F266BDB8A2_14","08BC3D640DB1_15", "0A7F789EFBA2_11","08BC3D640DB1_14",
              "278D8061B2A2_05", "DC395B3CC8A2_3M","B03385C1E3A2_13","2542D1625CA2_03","7B4E0CDAE8A2_14","A0EC5EB277A2_02", "F3BE3660F0A2-SK_01",
              "AC2DB1F248A2_3M","FDC849B4BFA2-SK_01","238AF1D07CA2_16","9249323B02A2_07","79FD6D1603A2_08","86CCE3AE09A2-SK_01", "3495EE330CA2_11","3495EE330CA2_10",
              "0677B362C6A2_11","4880CB93E3A2_08","674CF37825A2_05","D4C93A0446A2_03","713D6B6534A2_07","6AF8E2DDADA2_15","35D5BA9E5EA2_10","7B54C4FAEEB1_08",
              "BC26147BECA2-SK_05","0A7F789EFBA2_12","844E26F4B0A2_11", "6553E9B0FFA2_16","A32701D433A2_05","1708D266B1B1_14","FA8AD8BD1DA2_03",
              "EED92F1F55A2_12","28EFA1AD5AB1_14","B357E9BB61B1_10","A290507BB8A2_06","2D0EF351A6A2-SK_02","31851D333FA2_6M",
              "EB9B84517CA2_03","99F6DA6C37B1_09","9BB155D7D0B1_16","16A74EFEF4A2_12","65BBC9638AA2_09","3234E27F42B1_16","3F37D4C832A2_11","5F56BA3A4AB1_12",
              "8504D6FB2EA2_13","E72CDACCBAA2_15","8504D6FB2EA2_12","03419A0DEAA2-SK_01",
              "8504D6FB2EA2_14","58E7E02A9EB1_15", "3870E289B1A2_3M","4F267F4F54A2_16","BF6CDD9F6FA2_10","B984F164F8A2_01",
              "3BFB8F8246A2_09","32A73968C0A2_15", "F5936AD536A2_15", "840D327FDAA2_14", "9C3E0A5C7AA2_14", "E7E6C4D7F9A2_15",
              "BF00616007A2_12","E1A9F2741DB1_10")

SICGROUP
NeueTabelle110517 <- df[!paste0(df$CT_S_1_SIC,df$CT_S_1_GRUPPE) %in% SICGROUP, ]

library(openxlsx)
write.xlsx(x = NeueTabelle110517 , file = "NeueTabelle110517excel.xlsx")








x <- data.frame(a = 1:7, beta = exp(-3:3), logic = c(TRUE,FALSE,FALSE,TRUE,FALSE,FALSE,TRUE))
# compute the list mean for each list element
lapply(x,mean)
# median and quartiles for each list element
lapply(x, quantile, probs = 1:3/4)
sapply(x, quantile)
i39 <- sapply(3:9, seq) # list of vectors
sapply(i39, fivenum)

hist(replicate(100, mean(rexp(10))))
rexp(1)

plot(rexp(200))
